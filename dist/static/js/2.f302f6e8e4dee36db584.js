webpackJsonp([2],{"+wd3":function(e,t){},IgGk:function(e,t){},LgBn:function(e,t){},WNPb:function(e,t,a){"use strict";var i=a("Dd8w"),o=a.n(i),l=a("NYxO"),s={computed:o()({},Object(l.b)(["deptList","roleList"])),data:function(){return{valueId:null,valueTitle:""}},props:{formLabel:Array,seachForm:Object,editType:String,rules:Object,defaultProps:{id:"id",children:"children",label:"label"},options:{type:Array},value:{type:String}},methods:{handleNodeClick:function(e){this.seachForm.dept=e.label,this.valueId=e.id}}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{ref:"subFormEdit",attrs:{model:e.seachForm,"label-width":"80px",inline:"",rules:e.rules}},[e._l(e.formLabel,function(t){return a("el-form-item",{key:t.model,staticStyle:{"font-size":"12px"},attrs:{label:t.label,prop:t.model}},["input"===t.type?a("el-input",{attrs:{disabled:"add"!==e.editType&&t.disabled},model:{value:e.seachForm[t.model],callback:function(a){e.$set(e.seachForm,t.model,a)},expression:"seachForm[item.model]"}}):e._e(),e._v(" "),"password"===t.type?a("el-input",{attrs:{type:t.type,prop:t.model},model:{value:e.seachForm[t.model],callback:function(a){e.$set(e.seachForm,t.model,a)},expression:"seachForm[item.model]"}}):e._e(),e._v(" "),a("el-radio-group",{model:{value:e.seachForm[t.model],callback:function(a){e.$set(e.seachForm,t.model,a)},expression:"seachForm[item.model]"}},e._l(t.radio,function(t){return a("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(e._s(t.label))])}),1),e._v(" "),"treeSelect"===t.type?a("el-select",{ref:"select",refInFor:!0,attrs:{placeholder:"请选择",clearable:""},model:{value:e.seachForm.dept,callback:function(t){e.$set(e.seachForm,"dept",t)},expression:"seachForm.dept"}},[a("el-option",{key:e.valueId,staticStyle:{height:"auto"},attrs:{value:e.valueId}},[a("el-tree",{ref:"tree",refInFor:!0,attrs:{data:e.deptList,props:e.defaultProps,"default-expand-all":"","check-strictly":"","expand-on-click-node":!1},on:{"node-click":e.handleNodeClick}})],1)],1):e._e(),e._v(" "),"select"===t.type?a("el-select",{attrs:{placeholder:"请选择",clearable:""},model:{value:e.seachForm[t.model],callback:function(a){e.$set(e.seachForm,t.model,a)},expression:"seachForm[item.model]"}},e._l(e.roleList,function(e){return a("el-option",{key:e.id,attrs:{value:e.rname,label:e.label}})}),1):e._e(),e._v(" "),"switch"===t.type?a("el-switch",{attrs:{inline:!1},model:{value:e.seachForm[t.model],callback:function(a){e.$set(e.seachForm,t.model,a)},expression:"seachForm[item.model]"}}):e._e()],1)}),e._v(" "),a("el-form-item",[e._t("default")],2)],2)},staticRenderFns:[]};var r=a("VU/8")(s,n,!1,function(e){a("LgBn")},null,null);t.a=r.exports},"i/Eh":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("woOf"),o=a.n(i),l=a("Dd8w"),s=a.n(l),n=a("WNPb"),r={props:{tableData:Array,tableLabel:Array,config:Object},data:function(){return{pageSize:null}},methods:{handleEdit:function(e){this.$emit("edit",e)},handleDelete:function(e){this.$emit("del",e)},sizeChange:function(e){this.$store.commit("changePageSize",e),this.$emit("changeSizePage")},prev:function(e){this.$store.commit("changePage",e),this.$emit("changePage")},next:function(e){this.$store.commit("changePage",e),this.$emit("changePage")},change:function(e){this.$store.commit("changePage",e),this.$emit("changePage")},changeState:function(e){this.$emit("changState",e)},selectRows:function(e){this.$emit("selectRow",e)}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"common-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.config.loading,expression:"config.loading"}],attrs:{data:e.tableData,height:"380",stripe:""},on:{"selection-change":e.selectRows}},[a("el-table-column",{attrs:{prop:"date",label:"序号",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"margin-left":"10px",padding:"0"}},[e._v(e._s(t.$index+1))])]}}])}),e._v(" "),a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),e._l(e.tableLabel,function(t){return a("el-table-column",{key:t.prop,attrs:{label:t.label,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(i){return[a("el-tooltip",{attrs:{content:i.row.ustate?"已启用":"已禁用",placement:"right"}},["state"==t.prop?a("el-switch",{attrs:{"active-value":!0,"inactive-value":!1},on:{change:function(t){return e.changeState(i.row)}},model:{value:i.row.ustate,callback:function(t){e.$set(i.row,"ustate",t)},expression:"scope.row.ustate"}}):e._e()],1),e._v(" "),a("span",{staticStyle:{"margin-left":"10px","font-size":"12px"}},[e._v(e._s(i.row[t.prop]))])]}}],null,!0)})}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],2),e._v(" "),a("el-pagination",{attrs:{"current-page":e.config.page,"page-sizes":[20,50,200,500],"page-size":e.config.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.config.total},on:{"size-change":e.sizeChange,"prev-click":e.prev,"next-click":e.next,"current-change":e.change,"update:currentPage":function(t){return e.$set(e.config,"page",t)},"update:current-page":function(t){return e.$set(e.config,"page",t)},"update:pageSize":function(t){return e.$set(e.config,"pageSize",t)},"update:page-size":function(t){return e.$set(e.config,"pageSize",t)}}})],1)},staticRenderFns:[]};var c=a("VU/8")(r,d,!1,function(e){a("IgGk")},null,null).exports,p=a("NYxO"),u={computed:s()({},Object(p.b)(["deptList"])),methods:{handleNodeClick:function(e){this.$emit("selectDept",e)},add:function(){this.$emit("addnode")}}},h={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"dept"},[t("el-row",{staticClass:"team",attrs:{"in-line":"true"}},[t("p",[this._v("组织架构")]),this._v(" "),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:this.add}},[this._v("新建部门")])],1),this._v(" "),t("el-row",[t("el-tree",{attrs:{data:this.deptList,"default-expand-all":"","expand-on-click-node":!1},on:{"node-click":this.handleNodeClick}})],1)],1)},staticRenderFns:[]};var m=a("VU/8")(u,h,!1,function(e){a("+wd3")},"data-v-4d5d8d8a",null).exports,f={computed:s()({},Object(p.b)({pageSize:function(e){return e.pageSize},page:function(e){return e.page},selectDept:function(e){return e.selectDept},roleList:function(e){return e.roleList}})),components:{Form:n.a,Table:c,Dept:m},data:function(){var e=this;return{editType:"add",isShow:!1,allupdateShow:!1,bothForm:{dept:"",identity:""},bothLabel:[{model:"dept",label:"部门",type:"treeSelect"},{model:"identity",label:"角色",type:"select"}],editForm:{name:"",uname:"",upwd:"",ustate:"",sex:"",dept:"",identity:"",phone:""},editLabel:[{model:"name",label:"姓名",type:"input"},{model:"uname",label:"用户名",type:"input",disabled:!0},{model:"upwd",label:"密码",type:"password"},{model:"checkupwd",label:"确认密码",type:"password"},{model:"sex",label:"性别",type:"radio",radio:[{label:"男",value:1},{label:"女",value:0}]},{model:"ustate",label:"状态",type:"switch"},{model:"dept",label:"部门",type:"treeSelect"},{model:"identity",label:"角色",type:"select"},{model:"phone",label:"号码",type:"input"}],deptList:[{id:"1",label:"上海",children:[{id:"2",label:"销售部"}]}],deptForm:{dept:"",dname:""},deptLabel:[{model:"dept",label:"上级部门",type:"treeSelect"},{model:"dname",label:"部门名称",type:"input"}],identityList:[{id:"1",label:"部门经理"},{id:"2",label:"员工"}],seachForm:{dept:"",keyword:""},formLabel:[{model:"dept",label:"部门",type:"treeSelect"},{model:"keyword",label:"用户名",type:"input"}],tableData:[],tableLabel:[{prop:"name",label:"姓名"},{prop:"uname",label:"用户名"},{prop:"state",label:"状态"},{prop:"sexy",label:"性别"},{prop:"dept",label:"部门"},{prop:"identity",label:"角色"},{prop:"phone",label:"手机号码"}],config:{page:1,pageSize:null,total:25,loading:!1},rules:{name:[{required:!0,message:"请输入姓名",trigger:"blur"}],uname:[{required:!0,validator:function(t,a,i){if("add"!=e.editType)return i();if(!a)return i(new Error("请输入用户名"));if(!/^[a-z0-9]{3,12}$/.test(a))return i(new Error("英文或数字，长度再3-12之间"));var o="uname="+a;e.axios.post("http://127.0.0.1:3000/check",o).then(function(e){return-1==e.data.code?i(new Error("用户名已被注册")):i()})},trigger:"blur"}],upwd:[{required:!0,validator:function(t,a,i){if("add"==e.editType){if(!a)return i(new Error("请输入密码"));if(!/^(?=.*\d)(?=.*[a-z])(?=.*[~!@#$%^&*])[\da-z~!@#$%^&*]{6,12}$/.test(a))return i(new Error("必须包含数字、字母、特殊符号，长度在6-12之间"));i()}},trigger:"blur"}],checkupwd:[{required:!0,validator:function(t,a,i){if("add"==e.editType){if(!a)return i(new Error("请在此输入密码"));a!=e.editForm.upwd?(console.log(e.editForm.upwd),i(new Error("两次输入密码不一致"))):i()}},trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"change"}],dept:[{required:!0,message:"请选择部门",trigger:"change"}],identity:[{required:!0,message:"请选择角色",trigger:"change"}],phone:[{required:!0,message:"请输入手机号码",trigger:"blur"}]},arr:[],tableList:[]}},methods:{getJsonTree:function(e,t){for(var a=[],i=0;i<e.length;i++){var o=e[i];if(o.parent==t){var l={id:o.did,label:o.dname,children:this.getJsonTree(e,o.did)};a.push(l)}}return a},getDeptList:function(){var e=this;this.axios.get("http://127.0.0.1:3000/getDept").then(function(t){var a=e.getJsonTree(t.data.data,"");e.deptList=a,e.$store.commit("setDept",a)})},getSubDept:function(e){var t=this;return e&&(this.arr.push(e.label),e.children&&e.children.forEach(function(e){t.getSubDept(e)})),this.arr.join("','")},addnode:function(){this.isShow=!0,this.editType="addDept",this.editLabel=this.deptLabel,this.editForm=this.deptForm},select:function(e){var t=this.getSubDept(e);console.log(t),this.$store.commit("saveDept",t),this.$store.commit("changePage",1),this.config.page=this.page,this.getUser(),this.arr=[]},getUser:function(){var e=this;this.config.loading=!0;var t="http://127.0.0.1:3000/userList?page="+this.page+"&pageSize="+this.pageSize+"&dept="+this.selectDept;this.axios.get(t).then(function(t){var a=t.data.data.data;e.config.total=t.data.data.total,e.tableData=a.map(function(e){return e.ustate=1===e.ustate,e.sexy=1===e.sex?"男":"女",e}),console.log(e.tableData),e.config.loading=!1})},edit:function(e){this.isShow=!0,this.editType="edit",this.editLabel=this.editLabel.filter(function(e){return"password"==e.type&&(e=null),e}),this.editForm=o()({},e)},submit:function(){var e=this;this.$refs.formEdit.$refs.subFormEdit.validate(function(t){if(console.log(t),t){e.editForm.sexy="1"==e.editForm.sex?"男":"女";var a="";"add"==e.editType?(e.editForm.sexy="",a="http://127.0.0.1:3000/register"):a="edit"==e.editType?"http://127.0.0.1:3000/editUserInfo":"http://127.0.0.1:3000/addDept";var i=e.qs.stringify(e.editForm);console.log(e.editForm),e.axios.post(a,i).then(function(t){1==t.data.code?(e.$message({showClose:!0,type:"success",message:t.data.msg}),e.closeEvent(),e.getUser(),e.getDeptList()):e.$message({showClose:!0,type:"warning",message:t.data.msg})})}})},del:function(e){var t=this;this.$confirm("此操作将永久删除该用户，是否继续","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=t.qs.stringify(e);t.axios.post("http://127.0.0.1:3000/deleteUser",a).then(function(e){1==e.data.code?(t.$message({showClose:!0,type:"success",message:e.data.msg}),t.getUser()):t.$message.error(e.data.msg)})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},add:function(){this.isShow=!0,this.editForm.ustate=!0,this.editForm.sex=1,this.editType="add"},changeState:function(e){console.log(e);var t=this.qs.stringify(e);console.log(t);this.axios.post("http://127.0.0.1:3000/editUserInfo",t).then(function(e){})},closeEvent:function(){this.isShow=!1,this.allupdateShow=!1,this.editForm={name:"",uname:"",ustate:!0,upwd:"",sex:"",dept:"",identity:"",phone:""},this.editLabel=[{model:"name",label:"姓名",type:"input"},{model:"uname",label:"用户名",type:"input",disabled:!0},{model:"upwd",label:"密码",type:"password"},{model:"checkupwd",label:"确认密码",type:"password"},{model:"sex",label:"性别",type:"radio",radio:[{label:"男",value:1},{label:"女",value:0}]},{model:"ustate",label:"状态",type:"switch"},{model:"dept",label:"部门",type:"treeSelect"},{model:"identity",label:"角色",type:"select"},{model:"phone",label:"号码",type:"input"}],this.deptForm={dept:"",dname:""},this.bothLabel=[{model:"dept",label:"部门",type:"treeSelect"},{model:"identity",label:"角色",type:"select"}],this.bothForm={dept:"",identity:""}},selectTable:function(e){var t=this;this.tableList=[],e.forEach(function(e){t.tableList.push(e.uname)}),console.log(this.tableList)},bothIdentity:function(){this.allupdateShow=!0,this.bothLabel=this.bothLabel.filter(function(e){return"dept"==e.model&&(e=null),e})},bothDept:function(){this.allupdateShow=!0,this.bothLabel=this.bothLabel.filter(function(e){return"identity"==e.model&&(e=null),e})},bothSubmit:function(){var e=this;this.config.loading=!0,this.$refs.updateForm.$refs.subFormEdit.validate(function(t){if(t){var a=e.tableList.join("','");e.bothForm.tableData=a,console.log(e.bothForm);var i=e.qs.stringify(e.bothForm);e.axios.post("http://127.0.0.1:3000/bothUpdate",i).then(function(t){1==t.data.code?(e.$message({type:"success",showClose:!0,message:t.data.msg}),e.closeEvent(),e.getUser()):e.$message({type:"warning",showClose:!0,message:t.data.msg})})}}),this.config.loading=!1},search:function(){}},created:function(){this.getUser(),this.getDeptList()}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticClass:"user"},[e.isShow?a("el-dialog",{attrs:{title:"addDept"==e.editType?"新建部门":"add"==e.editType?"新增用户":"编辑用户",visible:e.isShow,"close-on-click-modal":!1},on:{"update:visible":function(t){e.isShow=t},close:e.closeEvent}},[a("Form",{ref:"formEdit",staticClass:"edit",attrs:{formLabel:e.editLabel,seachForm:e.editForm,rules:e.rules,editType:e.editType},on:{"update:editType":function(t){e.editType=t},"update:edit-type":function(t){e.editType=t}}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeEvent}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1):e._e(),e._v(" "),e.allupdateShow?a("el-dialog",{staticClass:"both",attrs:{title:"批量修改",width:"30%",visible:e.allupdateShow},on:{"update:visible":function(t){e.allupdateShow=t},close:e.closeEvent}},[a("Form",{ref:"updateForm",attrs:{formLabel:e.bothLabel,seachForm:e.bothForm,deptList:e.deptList,identityList:e.identityList,rules:e.rules}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.closeEvent}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.bothSubmit}},[e._v("保存")])],1)],1):e._e(),e._v(" "),a("el-col",{staticClass:"left",attrs:{span:4}},[a("Dept",{on:{selectDept:e.select,addnode:e.addnode}})],1),e._v(" "),a("el-col",{staticClass:"right",attrs:{span:20}},[a("div",{staticClass:"form"},[a("div",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.add}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.bothIdentity}},[e._v("修改角色")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.bothDept}},[e._v("修改部门")])],1),e._v(" "),a("Form",{attrs:{formLabel:e.formLabel,seachForm:e.seachForm,deptList:e.deptList}},[a("el-button",{attrs:{type:"primary",size:"mini"}},[e._v("搜索")])],1)],1),e._v(" "),a("Table",{staticClass:"table",attrs:{tableData:e.tableData,tableLabel:e.tableLabel,config:e.config},on:{changePage:e.getUser,changeSizePage:e.getUser,edit:e.edit,del:e.del,changState:e.changeState,selectRow:e.selectTable}})],1)],1)},staticRenderFns:[]};var b=a("VU/8")(f,g,!1,function(e){a("vXZZ")},"data-v-8dbfc8a0",null);t.default=b.exports},vXZZ:function(e,t){}});
//# sourceMappingURL=2.f302f6e8e4dee36db584.js.map